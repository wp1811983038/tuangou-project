<!--index.wxml-->
<view class="container">
  <!-- 位置授权提示 -->
  <view class="location-tip" wx:if="{{showLocationTip}}">
    <view class="location-tip-content">
      <view class="location-tip-icon">
        <icon type="warn" size="16" color="#FF4D4F"></icon>
      </view>
      <view class="location-tip-text">位置获取失败，无法显示附近商户</view>
      <view class="location-tip-actions">
        <text class="location-tip-btn" bindtap="getCurrentLocation">重试</text>
        <text class="location-tip-close" bindtap="closeLocationTip">×</text>
      </view>
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-container">
    <view class="location">
      <text class="location-icon"></text>
      <text class="location-name">{{location.name || '定位中...'}}</text>
    </view>
    <view class="search-bar">
      <icon type="search" size="14" color="#999"></icon>
      <text class="search-placeholder">搜索商家、商品</text>
    </view>
  </view>

  <!-- 边界范围内商户显示 -->
  <view class="nearby-merchants" wx:if="{{hasNearbyMerchant}}">
    <view class="nearby-title">附近可为您提供服务的商户</view>
    <view class="merchant-list">
      <view class="merchant-item" 
            wx:for="{{inBoundaryMerchants}}" 
            wx:key="id"
            data-id="{{item.id}}" 
            bindtap="onMerchantTap">
        <image src="{{item.logo}}" class="merchant-logo"></image>
        <view class="merchant-info">
          <text class="merchant-name">{{item.name}}</text>
          <text class="merchant-address">{{item.address}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 不在服务范围提示 -->
  <view class="no-service-tip" wx:if="{{!hasNearbyMerchant && location && !loading}}">
    <icon type="info" size="20" color="#999"></icon>
    <text>您当前位置不在任何商户的服务范围内</text>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">
      <view class="loading-spinner"></view>
      <text>加载中...</text>
    </view>
  </view>
</view>